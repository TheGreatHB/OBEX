<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\FindOrderbook.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> FindOrderbook.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>51/51</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/3</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>51/51</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity =0.8.3;
&nbsp;
import "./OBEX.sol";
&nbsp;
contract FindOrderBook {
    struct Order {
        address maker;
        address tokenFromMaker;
        address tokenFromTaker;
        uint256 amountFromMaker;
        uint256 amountTokens;
        uint256 amountSold;
        bool isEnd;
    }
&nbsp;
    OBEX public ex;
&nbsp;
    constructor(address _exchange) {
        ex = OBEX(_exchange);
    }
&nbsp;
    function myOrder(uint256 _page, uint256 _limit) external view returns (
        bytes32[] memory orderIds,
        address[] memory tokenFromMaker,
        address[] memory tokenFromTaker,
        uint256[] memory amountFromMaker,
        uint256[] memory amountTokens,
        uint256[] memory amountSold,
        bool[] memory isEnd
    ) {
        require(_limit &gt; 1);
        uint256 length = ex.makerOrderLength(msg.sender);
        uint256 pages = length / _limit;
        uint256 residue = length % _limit;
&nbsp;
        if(_page &lt; pages) {     //ex 260 length. 2P60R  //// [[0P 100L -&gt; 0~99 // 1P 100L -&gt; 100~199]] // 2P 100L -&gt; 200~259
            orderIds = new bytes32[](_limit);
            tokenFromMaker = new address[](_limit);
            tokenFromTaker = new address[](_limit);
            amountFromMaker = new uint256[](_limit);
            amountTokens = new uint256[](_limit);
            amountSold = new uint256[](_limit);
            isEnd = new bool[](_limit);
&nbsp;
            for (uint256 i = _page * _limit; i &lt; (_page + 1) * _limit; i++) { //from 0*100 before 1*100 : 0~99 &amp;&amp; 100~199 &amp;&amp; 200~299
                orderIds[i] = ex._ordersByMaker(msg.sender)[i];
                (
                    , 
                    tokenFromMaker[i], 
                    tokenFromTaker[i], 
                    amountFromMaker[i], 
                    amountTokens[i], 
                    amountSold[i], 
                    isEnd[i]
                ) = ex.orders(orderIds[i]);
            }
        } else {    //260 length. 2P60R  //// 0P 100L -&gt; 0~99 // 1P 100L -&gt; 100~199 // [[[2P 100L -&gt; 200~259]]] -&gt; 0~59
            orderIds = new bytes32[](residue);
            tokenFromMaker = new address[](residue);
            tokenFromTaker = new address[](residue);
            amountFromMaker = new uint256[](residue);
            amountTokens = new uint256[](residue);
            amountSold = new uint256[](residue);
            isEnd = new bool[](residue);
&nbsp;
            if(length &gt; _page * _limit) {
                for (uint256 i = 0; i &lt; residue; i++) { //from 2*100 to 2*100+59 : 0~59
                    orderIds[i] = ex._ordersByMaker(msg.sender)[(_page * _limit) + i];
                    (
                        , 
                        tokenFromMaker[i], 
                        tokenFromTaker[i], 
                        amountFromMaker[i], 
                        amountTokens[i], 
                        amountSold[i], 
                        isEnd[i]
                    ) = ex.orders(orderIds[i]);
                }
            }
        }
    }
&nbsp;
    //just for example.
    function orderBook(address _tokenA, address _tokenB, uint256 _page, uint256 _limit) external view returns (
        bytes32[] memory orderIds,
        address[] memory maker,
        uint256[] memory amountFromMaker,
        uint256[] memory amountTokens,
        uint256[] memory amountSold,
        bool[] memory isEnd
    ) {
        require(_limit &gt; 1);
        uint256 length = ex.tokensOrderLength(_tokenA, _tokenB);
        uint256 pages = length / _limit;
        uint256 residue = length % _limit;
&nbsp;
        if(_page &lt; pages) {     //ex 260 length. 2P60R  //// [[0P 100L -&gt; 0~99 // 1P 100L -&gt; 100~199]] // 2P 100L -&gt; 200~259
            orderIds = new bytes32[](_limit);
            maker = new address[](_limit);
            amountFromMaker = new uint256[](_limit);
            amountTokens = new uint256[](_limit);
            amountSold = new uint256[](_limit);
            isEnd = new bool[](_limit);
&nbsp;
            for (uint256 i = _page * _limit; i &lt; (_page + 1) * _limit; i++) { //from 0*100 before 1*100 : 0~99 &amp;&amp; 100~199 &amp;&amp; 200~299
                orderIds[i] = ex._ordersByTokens(_tokenA, _tokenB)[i];
                (
                    maker[i], 
                    , 
                    , 
                    amountFromMaker[i], 
                    amountTokens[i], 
                    amountSold[i], 
                    isEnd[i]
                ) = ex.orders(orderIds[i]);
            }
        } else {    //260 length. 2P60R  //// 0P 100L -&gt; 0~99 // 1P 100L -&gt; 100~199 // [[[2P 100L -&gt; 200~259]]]
            orderIds = new bytes32[](residue);
            maker = new address[](residue);
            amountFromMaker = new uint256[](residue);
            amountTokens = new uint256[](residue);
            amountSold = new uint256[](residue);
            isEnd = new bool[](residue);
&nbsp;
            if(length &gt; _page * _limit) {
                for (uint256 i = 0; i &lt; residue; i++) { //from 2*100 to 2*100+59 : 200~259
                    orderIds[i] = ex._ordersByTokens(_tokenA, _tokenB)[(_page * _limit) + i];
                    (
                        maker[i], 
                        , 
                        , 
                        amountFromMaker[i], 
                        amountTokens[i], 
                        amountSold[i], 
                        isEnd[i]
                    ) = ex.orders(orderIds[i]);
                }
            }
        }
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Apr 02 2021 02:28:21 GMT+0900 (대한민국 표준시)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
